{"ast":null,"code":"import React,{useEffect,useState}from'react';import axios from'axios';import{jwtDecode}from'jwt-decode';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ViewPollsPage=()=>{const[polls,setPolls]=useState([]);const[loading,setLoading]=useState(true);const[voteMessage,setVoteMessage]=useState('');useEffect(()=>{fetchPolls();},[]);const fetchPolls=async()=>{setLoading(true);try{const res=await axios.get('http://localhost:5000/api/polls/all');setPolls(res.data);}catch(_unused){setPolls([]);}setLoading(false);};const getUserIdFromToken=()=>{const token=localStorage.getItem('token');if(!token)return null;try{const decoded=jwtDecode(token);return decoded.userId||decoded._id||decoded.id||null;}catch(_unused2){return null;}};const handleVote=async(pollId,optionIndex)=>{const userId=getUserIdFromToken();setVoteMessage('');try{await axios.post(\"http://localhost:5000/api/polls/vote/\".concat(pollId,\"/\").concat(optionIndex),{userId},{headers:{Authorization:\"Bearer \".concat(localStorage.getItem('token')),role:localStorage.getItem('role')}});setVoteMessage('Vote submitted!');fetchPolls();}catch(err){setVoteMessage('Failed to submit vote.');}};return/*#__PURE__*/_jsxs(\"div\",{style:{margin:'40px auto',maxWidth:'700px',background:'#fff',borderRadius:'16px',boxShadow:'0 4px 24px rgba(30,64,175,0.10)',padding:'40px 32px',minHeight:'400px'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#1976d2',marginBottom:'24px',textAlign:'center'},children:\"Active Polls\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Loading polls...\"}):polls.length===0?/*#__PURE__*/_jsx(\"p\",{style:{textAlign:'center',color:'#888'},children:\"No polls available.\"}):polls.map(poll=>{const userId=getUserIdFromToken();return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'32px',padding:'24px',border:'1px solid #e3e9ee',borderRadius:'10px',background:'#f8fafc'},children:[/*#__PURE__*/_jsx(\"strong\",{style:{fontSize:'1.15rem',color:'#1976d2'},children:poll.question}),/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0,marginTop:'14px'},children:poll.options.map((opt,idx)=>{const hasVoted=poll.options.some(o=>o.votes.includes(userId));const votedThisOption=opt.votes.includes(userId);return/*#__PURE__*/_jsxs(\"li\",{style:{marginBottom:'10px',display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleVote(poll._id,idx),style:{marginRight:'12px',padding:'6px 18px',background:votedThisOption?'#388e3c':'#1976d2',color:'#fff',border:'none',borderRadius:'6px',fontWeight:600,cursor:'pointer',display:'flex',alignItems:'center'},children:hasVoted?votedThisOption?/*#__PURE__*/_jsxs(\"span\",{children:[\"Voted \",/*#__PURE__*/_jsx(\"span\",{title:\"Edit Vote\",style:{marginLeft:8,fontSize:'1.1em',opacity:0.7},children:\"\\u270F\\uFE0F Edit\"})]}):'Change Vote':'Vote'}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'1.08rem',color:'#222'},children:opt.text}),/*#__PURE__*/_jsxs(\"span\",{style:{marginLeft:'auto',color:'#1976d2',fontWeight:600},children:[opt.votes.length,\" votes\"]})]},idx);})})]},poll._id);}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#1976d2',textAlign:'center',marginTop:'18px'},children:voteMessage}),voteMessage&&/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',marginTop:'12px'},children:/*#__PURE__*/_jsx(\"button\",{onClick:fetchPolls,style:{padding:'8px 16px',background:'#1976d2',color:'#fff',border:'none',borderRadius:'4px',fontWeight:500,cursor:'pointer'},children:\"Refresh Polls\"})})]});};export default ViewPollsPage;","map":{"version":3,"names":["React","useEffect","useState","axios","jwtDecode","jsx","_jsx","jsxs","_jsxs","ViewPollsPage","polls","setPolls","loading","setLoading","voteMessage","setVoteMessage","fetchPolls","res","get","data","_unused","getUserIdFromToken","token","localStorage","getItem","decoded","userId","_id","id","_unused2","handleVote","pollId","optionIndex","post","concat","headers","Authorization","role","err","style","margin","maxWidth","background","borderRadius","boxShadow","padding","minHeight","children","color","marginBottom","textAlign","length","map","poll","border","fontSize","question","listStyle","marginTop","options","opt","idx","hasVoted","some","o","votes","includes","votedThisOption","display","alignItems","onClick","marginRight","fontWeight","cursor","title","marginLeft","opacity","text"],"sources":["C:/Users/ADMIN/Desktop/hyd/hyd/frontend/src/employee/components/ViewPollsPage.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\nconst ViewPollsPage = () => {\r\n  const [polls, setPolls] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [voteMessage, setVoteMessage] = useState('');\r\n\r\n  useEffect(() => {\r\n    fetchPolls();\r\n  }, []);\r\n\r\n  const fetchPolls = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await axios.get('http://localhost:5000/api/polls/all');\r\n      setPolls(res.data);\r\n    } catch {\r\n      setPolls([]);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  const getUserIdFromToken = () => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) return null;\r\n    try {\r\n      const decoded = jwtDecode(token);\r\n      return decoded.userId || decoded._id || decoded.id || null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const handleVote = async (pollId, optionIndex) => {\r\n    const userId = getUserIdFromToken();\r\n    setVoteMessage('');\r\n    try {\r\n      await axios.post(\r\n        `http://localhost:5000/api/polls/vote/${pollId}/${optionIndex}`,\r\n        { userId },\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n            role: localStorage.getItem('role')\r\n          }\r\n        }\r\n      );\r\n      setVoteMessage('Vote submitted!');\r\n      fetchPolls();\r\n    } catch (err) {\r\n      setVoteMessage('Failed to submit vote.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ margin: '40px auto', maxWidth: '700px', background: '#fff', borderRadius: '16px', boxShadow: '0 4px 24px rgba(30,64,175,0.10)', padding: '40px 32px', minHeight: '400px' }}>\r\n      <h2 style={{ color: '#1976d2', marginBottom: '24px', textAlign: 'center' }}>Active Polls</h2>\r\n      {loading ? (\r\n        <p>Loading polls...</p>\r\n      ) : polls.length === 0 ? (\r\n        <p style={{ textAlign: 'center', color: '#888' }}>No polls available.</p>\r\n      ) : (\r\n        polls.map((poll) => {\r\n          const userId = getUserIdFromToken();\r\n          return (\r\n            <div key={poll._id} style={{ marginBottom: '32px', padding: '24px', border: '1px solid #e3e9ee', borderRadius: '10px', background: '#f8fafc' }}>\r\n              <strong style={{ fontSize: '1.15rem', color: '#1976d2' }}>{poll.question}</strong>\r\n              <ul style={{ listStyle: 'none', padding: 0, marginTop: '14px' }}>\r\n                {poll.options.map((opt, idx) => {\r\n                  const hasVoted = poll.options.some(o => o.votes.includes(userId));\r\n                  const votedThisOption = opt.votes.includes(userId);\r\n                  return (\r\n                    <li key={idx} style={{ marginBottom: '10px', display: 'flex', alignItems: 'center' }}>\r\n                      <button\r\n                        onClick={() => handleVote(poll._id, idx)}\r\n                        style={{\r\n                          marginRight: '12px',\r\n                          padding: '6px 18px',\r\n                          background: votedThisOption ? '#388e3c' : '#1976d2',\r\n                          color: '#fff',\r\n                          border: 'none',\r\n                          borderRadius: '6px',\r\n                          fontWeight: 600,\r\n                          cursor: 'pointer',\r\n                          display: 'flex',\r\n                          alignItems: 'center'\r\n                        }}\r\n                      >\r\n                        {hasVoted\r\n                          ? (votedThisOption\r\n                              ? (<span>Voted <span title=\"Edit Vote\" style={{ marginLeft: 8, fontSize: '1.1em', opacity: 0.7 }}>✏️ Edit</span></span>)\r\n                              : 'Change Vote')\r\n                          : 'Vote'}\r\n                      </button>\r\n                      <span style={{ fontSize: '1.08rem', color: '#222' }}>{opt.text}</span>\r\n                      <span style={{ marginLeft: 'auto', color: '#1976d2', fontWeight: 600 }}>\r\n                        {opt.votes.length} votes\r\n                      </span>\r\n                    </li>\r\n                  );\r\n                })}\r\n              </ul>\r\n            </div>\r\n          );\r\n        })\r\n      )}\r\n      <p style={{ color: '#1976d2', textAlign: 'center', marginTop: '18px' }}>{voteMessage}</p>\r\n      {voteMessage && (\r\n        <div style={{ textAlign: 'center', marginTop: '12px' }}>\r\n          <button\r\n            onClick={fetchPolls}\r\n            style={{\r\n              padding: '8px 16px',\r\n              background: '#1976d2',\r\n              color: '#fff',\r\n              border: 'none',\r\n              borderRadius: '4px',\r\n              fontWeight: 500,\r\n              cursor: 'pointer'\r\n            }}\r\n          >\r\n            Refresh Polls\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ViewPollsPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}